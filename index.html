<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <title>官網</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" >
    <link rel="stylesheet" href="./css/css_var.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/official_website.css">
    <script src="./js/universal.js"></script>
    <script src="./js/path.js"></script>
    <script src="./js/base_path.js"></script>
    <script src="./js/page_universal_files.js"></script>
  </head>
  <body>
    <main id="official_website">
      <header class="official_website">
        <div class="menu">
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
          <img src="https://images.plurk.com/2S5jt205th6ewSoWXJKHM7.png"/>
        </div>
        <div class="sub_menu"></div>
        <button id="cur_page" onclick="header_toggle()">
          <img src="https://images.plurk.com/7sc67NLU4Tnj2q2SAqkdMk.png"/>
        </button>
        <button id="open_game_btn">啟動遊戲</button>
      </header>
      <div id="content" class="hidden"></div>
      <footer class="official_website">
        <div id="breadcrumb">
          <div>載入中...</div>
        </div>
        <button id="sitemap_btn"></button>
      </footer>
    </main>
    <script>
      window.onload = () => {
        set_content_src();
      };
      window.onhashchange = set_content_src;
      function set_content_src() {
        content.classList.add('hidden');
        setTimeout(() => {
          let hash = location.hash.substr(1);
          if(!hash) return location.replace("#/");
          let path = path_list[hash];
          if(!path) {
            location.replace("#/404");
            location.reload();
            return;
          }
          set_breadcrumb(path.breadcrumb);
          change_content("./pages" + path.src);
        }, 300);
      }
      function change_content(src) {
        let new_iframe = new_el('iframe');
        new_iframe.onload = () => {
          new_iframe.contentWindow.to_page = (hash) => location.hash = hash;
          create_universal_file(new_iframe.contentWindow.document);
        };
        content.innerHTML = "";
        content.appendChild(new_iframe);
        new_iframe.src = src;
      }
      function set_breadcrumb(breadcrumb = "") {
        find("#breadcrumb").innerHTML = breadcrumb.split("/")
        .map(name => name ? "<div>" + name + "</div>" : "").join("");
      }
      function header_toggle() {
        document.querySelector('header').classList.toggle('open');
      }
      function create_universal_file(target_doc) {
        page_universal_files.forEach(({type, path}) => {
          if(type == "css") {
            let el = new_el('link');
            el.rel = "stylesheet";
            el.href = base_path + "/css/" + path;
            el.onload = on_all_load;
            target_doc.head.append(el);
          }
          else if(type == "js") {
            let el = new_el('script');
            el.src = base_path + "/js/" + path;
            el.onload = on_all_load;
            target_doc.head.append(el);
          }
        });
        let loaded = 0;
        function on_all_load() {
          if(++loaded < page_universal_files.length) return;
          let el = new_el('script');
          el.innerHTML = "set_to_page_event()";
          target_doc.body.append(el);
          setTimeout(() => content.classList.remove('hidden'), 100);
        }
      }
    </script>
  </body>
</html>